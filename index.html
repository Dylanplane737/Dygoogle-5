<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Nova</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" type="image/png" href="falcon.png">

<style>
/* Basic layout */
body {
  font-family: "Pixelify Sans", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background-color: #2596be;
  color: white;
  text-align: center;
  margin: 32px 12px;
  transition: background 0.3s ease;
}
.logo { font-size: 56px; font-weight: 800; margin: 8px 0 20px; text-align: center; }
.search-wrap { position: relative; max-width: 560px; margin: 0 auto; }
input#urlInput {
  width: 100%; padding: 12px 16px; font-size: 16px; border-radius: 999px; border: 1px solid rgba(0,0,0,0.1);
  box-sizing: border-box; transition: box-shadow 150ms ease, transform 120ms ease, border-color 150ms ease;
}
button { margin-top: 12px; padding: 12px 26px; border-radius: 28px; border: none; cursor: pointer; background:#0f75a8; color:white; box-shadow: 0 6px 12px rgba(0,0,0,0.12); }
button:hover { transform: translateY(-2px); }

/* Suggestions */
.suggestions { position: absolute; left: 0; right: 0; top: 52px; background: white; color: #222; border-radius: 10px; box-shadow: 0 6px 18px rgba(0,0,0,0.12); z-index: 30; max-height: 240px; overflow:auto; display:none; }
.suggestions.show { display:block; }
.suggestions div { padding: 8px 12px; cursor:pointer; }
.suggestions div:hover, .suggestions .highlighted { background:#0f75a8; color:white; }

/* Results */
#resultContainer { display:none; margin-top:28px; max-width:1200px; margin-left:auto; margin-right:auto; gap:20px; justify-content:center; align-items:flex-start; }
#resultContainer.visible { display:flex; flex-wrap:wrap; }
#wikiSummary, #relatedMedia { background: rgba(0,0,0,0.28); padding:18px; border-radius:12px; box-sizing:border-box; color:white; }
#wikiSummary { width: 44%; min-width:260px; text-align:left; max-height:720px; overflow:auto; }
#relatedMedia { width: 44%; min-width:260px; display:flex; flex-direction:column; gap:12px; max-height:720px; overflow:auto; }
#wikiSummary img { width:100%; border-radius:10px; box-shadow: 0 6px 18px rgba(0,0,0,0.25); }
.media-section { display:flex; gap:8px; flex-wrap:wrap; padding:10px; background:rgba(255,255,255,0.03); border-radius:10px; max-height:320px; overflow:auto; }
.media-section img, .media-section video { width:160px; height:110px; object-fit:cover; border-radius:8px; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,0.25); transition:transform .12s ease; }
.media-section img:hover, .media-section video:hover { transform:scale(1.06); }

/* Spinner */
.spinner { display:none; margin:20px auto; border:6px solid rgba(255,255,255,0.25); border-top:6px solid white; border-radius:50%; width:52px; height:52px; animation:spin 1s linear infinite; }
.spinner.visible { display:block; }
@keyframes spin { to { transform:rotate(360deg); } }

/* Lightbox */
#lightbox { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.92); z-index:1000; align-items:center; justify-content:center; }
#lightbox.show { display:flex; }
#lightbox img { max-width:92%; max-height:86%; border-radius:10px; box-shadow: 0 10px 40px rgba(0,0,0,0.6); }
#lightbox .close, .nav { color:white; cursor:pointer; user-select:none; position:fixed; font-size:28px; }
#lightbox .close { right:22px; top:18px; font-size:28px; }
#lightbox .nav.prev { left:16px; top:50%; transform:translateY(-50%); font-size:48px; }
#lightbox .nav.next { right:16px; top:50%; transform:translateY(-50%); font-size:48px; }

/* Responsive */
@media (max-width:900px) {
  #wikiSummary,#relatedMedia { width: 100%; }
  .media-section img, .media-section video { width:140px; height:100px; }
}
</style>
</head>

<body>
<header>
  <div class="logo"></div>
</header>

<main>
  <section class="search-wrap">
    <input id="urlInput" placeholder="Search..." autocomplete="off" />
    <div id="suggestionBox" class="suggestions" role="listbox"></div>
  </section>

  <div id="loadingSpinner" class="spinner" aria-hidden="true"></div>

  <section id="resultContainer">
    <article id="wikiSummary"></article>
    <aside id="relatedMedia">
      <h3 style="margin-top:0">Related Images</h3>
      <div id="imagesSection" class="media-section" aria-live="polite"></div>
      <h3 style="margin:0 0 6px 0">Related Videos</h3>
      <div id="videosSection" class="media-section"></div>
    </aside>
  </section>

  <div id="lightbox" aria-hidden="true">
    <span class="close" id="closeLightbox">&times;</span>
    <span class="nav prev" id="lightPrev">&#10094;</span>
    <img id="lightboxImg" alt="Expanded image"/>
    <span class="nav next" id="lightNext">&#10095;</span>
  </div>

  <div style="text-align:center; margin-top:16px;">
    <button id="openBtn">Open</button>
  </div>
</main>

<script src="Dygoogle5stuff.js"></script>
<script src="Main.js"></script>

<script>
/* === Logo === */
const logoDiv = document.querySelector('.logo');
if(logoDiv){
  const logoImg = document.createElement('img');
  logoImg.src = "Novalogo.png";
  logoImg.alt = "Nova Logo";
  logoImg.style.width = "160px";
  logoImg.style.height = "auto";
  logoImg.style.display = "block";
  logoImg.style.margin = "0 auto 16px";
  logoDiv.appendChild(logoImg);
}

/* === Elements === */
const urlInput = document.getElementById("urlInput");
const suggestionBox = document.getElementById("suggestionBox");
const spinner = document.getElementById("loadingSpinner");
const resultContainer = document.getElementById("resultContainer");
const imagesSection = document.getElementById("imagesSection");
const videosSection = document.getElementById("videosSection");
const wikiSummaryEl = document.getElementById("wikiSummary");
const lightbox = document.getElementById("lightbox");
const lightboxImg = document.getElementById("lightboxImg");
const closeLightbox = document.getElementById("closeLightbox");
const lightPrev = document.getElementById("lightPrev");
const lightNext = document.getElementById("lightNext");

/* === Search helpers === */
function showSpinner(){ spinner.classList.add("visible"); }
function hideSpinner(){ spinner.classList.remove("visible"); }
function formatURL(input){ return input.startsWith("http") ? input : "https://"+input; }
function isProbablyURL(str){ return /^https?:\/\//.test(str) || /^[^\s]+\.[^\s]{2,}$/.test(str); }

/* === Lightbox === */
let imagesList = [];
let currentLightIndex = -1;
function openLightbox(index){ currentLightIndex=index; lightboxImg.src=imagesList[index]; lightbox.classList.add("show"); }
function closeLightboxFn(){ lightbox.classList.remove("show"); currentLightIndex=-1; }
function lightNextFn(){ currentLightIndex=(currentLightIndex+1)%imagesList.length; lightboxImg.src=imagesList[currentLightIndex]; }
function lightPrevFn(){ currentLightIndex=(currentLightIndex-1+imagesList.length)%imagesList.length; lightboxImg.src=imagesList[currentLightIndex]; }
closeLightbox.onclick=closeLightboxFn;
lightNext.onclick=lightNextFn;
lightPrev.onclick=lightPrevFn;
document.addEventListener("keydown", e=>{
  if(lightbox.classList.contains("show")){
    if(e.key==="Escape") closeLightboxFn();
    if(e.key==="ArrowRight") lightNextFn();
    if(e.key==="ArrowLeft") lightPrevFn();
  }
});

/* === Open Website === */
async function openWebsite(){
  const input = urlInput.value.trim();
  if(!input){ alert("Please enter something!"); return; }
  imagesSection.innerHTML=""; videosSection.innerHTML=""; imagesList=[];
  resultContainer.classList.remove("visible");
  
  // Check if URL
  if(isProbablyURL(input)){ window.open(formatURL(input), "_blank"); return; }

  showSpinner();
  try{
    // Wikipedia summary
    const summary = await getWikiSummary(input);
    if(!summary){ alert("No Wikipedia article found."); return; }
    wikiSummaryEl.innerHTML=`<h2>${summary.title}</h2>${summary.thumbnail?`<img src="${summary.thumbnail}">`:''}<p>${summary.extract}</p><p><a href="${summary.fullurl}" target="_blank" style="color:#a8d0e6">Read more</a></p>`;
    resultContainer.classList.add("visible");

    // Wikimedia images
    const { images, videos } = await getCommonsMedia(input);
    const fragment = document.createDocumentFragment();
    images.forEach(src=>{
      const img=document.createElement("img");
      img.src=src; img.loading="lazy"; img.onclick=()=>openLightbox(imagesList.indexOf(src));
      fragment.appendChild(img);
      imagesList.push(src);
    });
    imagesSection.appendChild(fragment);

    videosSection.innerHTML = videos.length ? videos.map(v=>`<video src="${v}" controls></video>`).join('') : "<p>No videos found</p>";

  }catch(err){ console.error(err); alert("Error fetching info."); }
  finally{ hideSpinner(); }
}

/* === Event listeners === */
document.getElementById("openBtn").onclick=openWebsite;
urlInput.addEventListener("keydown", e=>{ if(e.key==="Enter") openWebsite(); });

/* === Autocomplete === */
let highlightedIndex=-1, debounceTimer;
urlInput.addEventListener("input", e=>{
  clearTimeout(debounceTimer);
  debounceTimer=setTimeout(()=>showSuggestions(e.target.value.trim()), 240);
});

async function showSuggestions(input){
  suggestionBox.innerHTML=""; highlightedIndex=-1;
  if(!input){ suggestionBox.classList.remove("show"); return; }
  const list=await fetchWikiSuggestions(input);
  if(!list.length){ suggestionBox.classList.remove("show"); return; }
  list.forEach(item=>{
    const d=document.createElement("div");
    d.textContent=item; d.tabIndex=0;
    d.onclick=()=>{ urlInput.value=item; suggestionBox.innerHTML=""; suggestionBox.classList.remove("show"); };
    suggestionBox.appendChild(d);
  });
  suggestionBox.classList.add("show");
}
</script>
</body>
</html>
